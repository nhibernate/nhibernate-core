//------------------------------------------------------------------------------
// <auto-generated>
//     This code was generated by AsyncGenerator.
//
//     Changes to this file may cause incorrect behavior and will be lost if
//     the code is regenerated.
// </auto-generated>
//------------------------------------------------------------------------------


using System;
using System.Collections;
using System.Collections.Generic;
using System.Linq;
using System.Linq.Expressions;
using System.Threading;
using System.Threading.Tasks;
using NHibernate.Criterion;
using NHibernate.Engine;

namespace NHibernate.Multi
{
	public static partial class QueryBatchExtensions
	{

		#region Helper classes

		partial class FutureValue<TResult> : IFutureValue<TResult>
		{

			public async Task<TResult> GetValueAsync(CancellationToken cancellationToken = default(CancellationToken))
			{
				cancellationToken.ThrowIfCancellationRequested();
				if (_futureList == null)
					return _result;

				_result = (await (_futureList.GetValueAsync(cancellationToken)).ConfigureAwait(false)).FirstOrDefault();
				_futureList = null;

				return _result;
			}
		}

		partial class FutureList<TResult> : IFutureList<TResult>
		{

			public async Task<IList<TResult>> GetValueAsync(CancellationToken cancellationToken = default(CancellationToken))
			{
				cancellationToken.ThrowIfCancellationRequested();
				if (_batch == null)
					return _list;

				if (!_batch.IsExecutedOrEmpty)
					await (_batch.ExecuteAsync(cancellationToken)).ConfigureAwait(false);
				_list = _query.GetResults();

				_batch = null;
				_query = null;

				return _list;
			}
		}

		partial class FutureEnumerable<TResult> : IFutureEnumerable<TResult>
		{

			public async Task<IEnumerable<TResult>> GetEnumerableAsync(CancellationToken cancellationToken = default(CancellationToken))
			{
				cancellationToken.ThrowIfCancellationRequested();
				return await (_result.GetValueAsync(cancellationToken)).ConfigureAwait(false);
			}
		}

		#endregion Helper classes
	}
}
