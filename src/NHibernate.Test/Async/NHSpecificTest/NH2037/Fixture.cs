//------------------------------------------------------------------------------
// <auto-generated>
//     This code was generated by AsyncGenerator.
//
//     Changes to this file may cause incorrect behavior and will be lost if
//     the code is regenerated.
// </auto-generated>
//------------------------------------------------------------------------------


using NUnit.Framework;

namespace NHibernate.Test.NHSpecificTest.NH2037
{
	using System.Threading.Tasks;
	[TestFixture]
	public class FixtureAsync : BugTestCase
	{
		[Test]
		public async Task TestAsync()
		{
			var country = new Country { Name = "Argentina" };

			var city = new City
			           	{
			           		CityCode = 5,
			           		Country = country,
			           		Name = "Cordoba"
			           	};


			using (ISession session = OpenSession())
			using (var tx = session.BeginTransaction())
			{
				await (session.SaveAsync(city.Country));
				await (session.SaveAsync(city));
				await (tx.CommitAsync());
			}

			using (ISession session = OpenSession())
			using (var tx = session.BeginTransaction())
			{
				//THROW
				await (session.SaveOrUpdateAsync(city));
				await (tx.CommitAsync());
			}

			using (var session = OpenSession())
			using (var tx = session.BeginTransaction())
			{
				Assert.IsNotNull(await (session.GetAsync<City>(city.Id)));
				await (tx.CommitAsync());
			}
		}

		protected override void OnTearDown()
		{
			using (var session = OpenSession())
			using (var tx = session.BeginTransaction())
			{
				session.Delete("from City");
				session.Delete("from Country");
				tx.Commit();
			}
		}
	}
}
