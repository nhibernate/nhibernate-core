//------------------------------------------------------------------------------
// <auto-generated>
//     This code was generated by AsyncGenerator.
//
//     Changes to this file may cause incorrect behavior and will be lost if
//     the code is regenerated.
// </auto-generated>
//------------------------------------------------------------------------------


using NHibernate.Criterion;
using NHibernate.Transform;
using NUnit.Framework;

namespace NHibernate.Test.NHSpecificTest.NH2746
{
	using System.Threading.Tasks;
	[TestFixture]
	public class FixtureAsync: BugTestCase
	{
		[Test]
		public void TestQueryAsync()
		{
			if (!Dialect.SupportsSubSelectsWithPagingAsInPredicateRhs)
				Assert.Ignore("Current dialect does not support paging within IN sub-queries");

			using (ISession session = OpenSession())
			{
				DetachedCriteria page = DetachedCriteria.For<T1>()
					.SetFirstResult(3)
					.SetMaxResults(7)
					.AddOrder(NHibernate.Criterion.Order.Asc(Projections.Id()))
					.SetProjection(Projections.Id());

				ICriteria crit = session.CreateCriteria<T1>()
					.Add(Subqueries.PropertyIn("id", page))
					.SetResultTransformer(new DistinctRootEntityResultTransformer())
					.Fetch("Children");

				session.EnableFilter("nameFilter").SetParameter("name", "Another child");

				Assert.That(() => crit.ListAsync<T1>(), Throws.Nothing);
			}
		}
	}
}
