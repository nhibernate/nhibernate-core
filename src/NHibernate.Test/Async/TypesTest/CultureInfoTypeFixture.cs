//------------------------------------------------------------------------------
// <auto-generated>
//     This code was generated by AsyncGenerator.
//
//     Changes to this file may cause incorrect behavior and will be lost if
//     the code is regenerated.
// </auto-generated>
//------------------------------------------------------------------------------


using System;
using System.Globalization;
using NHibernate.Dialect;
using NHibernate.Type;
using NUnit.Framework;

namespace NHibernate.Test.TypesTest
{
	using System.Threading.Tasks;
	[TestFixture]
	public class CultureInfoTypeFixtureAsync : TypeFixtureBase
	{
		protected override string TypeName => "CultureInfo";

		[Test]
		public async Task ReadWriteBasicCultureAsync()
		{
			Guid id;
			using (var s = OpenSession())
			using (var t = s.BeginTransaction())
			{
				var entity = new CultureInfoClass { BasicCulture = CultureInfo.GetCultureInfo("en-US") };
				await (s.SaveAsync(entity));
				id = entity.Id;
				await (t.CommitAsync());
			}

			using (var s = OpenSession())
			using (var t = s.BeginTransaction())
			{
				var entity = await (s.GetAsync<CultureInfoClass>(id));
				Assert.That(entity.BasicCulture, Is.Not.Null);
				Assert.That(entity.BasicCulture.Name, Is.EqualTo("en-US"));
				Assert.That(entity.BasicCulture, Is.EqualTo(CultureInfo.GetCultureInfo("en-US")));
				entity.BasicCulture = CultureInfo.GetCultureInfo("fr-BE");
				await (t.CommitAsync());
			}

			using (var s = OpenSession())
			using (var t = s.BeginTransaction())
			{
				var entity = await (s.GetAsync<CultureInfoClass>(id));
				Assert.That(entity.BasicCulture.Name, Is.EqualTo("fr-BE"));
				Assert.That(entity.BasicCulture, Is.EqualTo(CultureInfo.GetCultureInfo("fr-BE")));
				entity.BasicCulture = null;
				await (t.CommitAsync());
			}

			using (var s = OpenSession())
			using (var t = s.BeginTransaction())
			{
				var entity = await (s.GetAsync<CultureInfoClass>(id));
				Assert.That(entity.BasicCulture, Is.Null);
				await (t.CommitAsync());
			}
		}

		[Test]
		public async Task ReadWriteExtendedCultureAsync()
		{
			Guid id;
			using (var s = OpenSession())
			using (var t = s.BeginTransaction())
			{
				var entity = new CultureInfoClass { ExtendedCulture = CultureInfo.GetCultureInfo("en-US-posix") };
				await (s.SaveAsync(entity));
				id = entity.Id;
				await (t.CommitAsync());
			}

			using (var s = OpenSession())
			using (var t = s.BeginTransaction())
			{
				var entity = await (s.GetAsync<CultureInfoClass>(id));
				Assert.That(entity.ExtendedCulture, Is.Not.Null);
				// Under Windows, it is named en-US-posix, but en-US-POSIX under Linux.
				Assert.That(entity.ExtendedCulture.Name, Is.EqualTo("en-US-posix").IgnoreCase);
				Assert.That(entity.ExtendedCulture, Is.EqualTo(CultureInfo.GetCultureInfo("en-US-posix")));
				await (t.CommitAsync());
			}
		}

		[Test]
		public async Task WriteTooLongCultureAsync()
		{
			if (Dialect is SQLiteDialect)
				Assert.Ignore("SQLite has no length limited string type.");
			using var s = OpenSession();
			using var t = s.BeginTransaction();
			var entity = new CultureInfoClass { BasicCulture = CultureInfo.GetCultureInfo("en-US-posix") };
			await (s.SaveAsync(entity));
			Assert.That(t.Commit, Throws.Exception);
		}
	}
}
