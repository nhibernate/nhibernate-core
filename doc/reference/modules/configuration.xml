<chapter id="session-configuration">

    <title>ISessionFactory Configuration</title>
    
    <para>
        Because NHibernate is designed to operate in many different environments, there
        are a large number of configuration parameters. Fortunately, most have sensible
        default values and NHibernate is distributed with an example 
        <literal>App.config</literal> file (found in <literal>src\NHibernate.Test</literal>)
        that shows the various options. You usually only have to put that file in your
        project and customize it.
    </para>

    <sect1 id="configuration-programmatic">
        <title>Programmatic Configuration</title>

        <para>
            An instance of <literal>NHibernate.Cfg.Configuration</literal>
            represents an entire set of mappings of an application's .NET types to a
            SQL database. The <literal>Configuration</literal> is used to build an
            (immutable) <literal>ISessionFactory</literal>. The mappings are compiled
            from various XML mapping files.
        </para>

        <para>
            You may obtain a <literal>Configuration</literal> instance by
            instantiating it directly. Heres an example of setting up a datastore from 
            mappings defined in two XML configuration files:
        </para>

        <programlisting><![CDATA[Configuration cfg = new Configuration()
    .AddFile("Item.hbm.xml")
    .AddFile("Bid.hbm.xml");]]></programlisting>

        <para>
            An alternative (sometimes better) way is to let NHibernate load a mapping file
            from an embedded resource:
        </para>

        <programlisting><![CDATA[Configuration cfg = new Configuration()
    .AddClass(typeof(NHibernate.Auction.Item))
    .AddClass(typeof(NHibernate.Auction.Bid));]]></programlisting>

        <para>
            Then NHibernate will look for mapping files named
            <literal>NHibernate.Auction.Item.hbm.xml</literal> and
            <literal>NHibernate.Auction.Bid.hbm.xml</literal> embedded as resources in the
            assembly that the types are contained in. This approach eliminates any hardcoded
            filenames.
        </para>
        
        <para>
            Another alternative (probably the best) way is to let NHibernate load all of 
            the mapping files contained in an Assembly:
        </para>

        <programlisting><![CDATA[Configuration cfg = new Configuration()
    .AddAssembly( "NHibernate.Auction" );]]></programlisting>

        <para>
            Then NHibernate will look through the assembly for any resources that
            end with <literal>.hbm.xml</literal>.  This approach eliminates 
            any hardcoded filenames and ensures the mapping files in the assembly
            get added.
        </para>
        
        <para>
            If a tool like Visual Studio .NET or NAnt is used to build the assembly,
            then make sure that the <literal>.hbm.xml</literal> files are compiled
            into the assembly as <literal>Embedded Resources</literal>.
        </para>
        
        <para>
            A <literal>Configuration</literal> also specifies various optional properties:
        </para>

        <programlisting><![CDATA[IDictionary props = new Hashtable();
...
Configuration cfg = new Configuration()
    .AddClass(typeof(NHibernate.Auction.Item))
    .AddClass(typeof(NHibernate.Auction.Bind))
    .SetProperties(props);]]></programlisting>

        <para>
            A <literal>Configuration</literal> is intended as a configuration-time object, to be
            discarded once an <literal>ISessionFactory</literal> is built.
        </para>

    </sect1>
    
    <sect1 id="configuration-sessionfactory">
        <title>Obtaining an ISessionFactory</title>

        <para>
            When all mappings have been parsed by the <literal>Configuration</literal>, the application
            must obtain a factory for <literal>ISession</literal> instances. This factory is intended
            to be shared by all application threads:
        </para>

        <programlisting><![CDATA[ISessionFactory sessions = cfg.BuildSessionFactory();]]></programlisting>

        <para>
            However, NHibernate does allow your application to instantiate more than one
            <literal>ISessionFactory</literal>. This is useful if you are using more than one database.
        </para>

    </sect1>

    <sect1 id="configuration-userjdbc">
        <title>User provided ADO.NET connection</title>

        <para>
            An <literal>ISessionFactory</literal> may open an <literal>ISession</literal> on 
            a user-provided ADO.NET connection. This design choice frees the application to 
            obtain ADO.NET connections wherever it pleases:
        </para>

        <programlisting><![CDATA[IDbConnection conn = myApp.GetOpenConnection();
ISession session = sessions.OpenSession(conn);

// do some data access work]]></programlisting>

        <para>
            The application must be careful not to open two concurrent
            <literal>ISession</literal>s on the same ADO.NET connection!
        </para>

    </sect1>


    <sect1 id="configuration-hibernatejdbc">
        <title>NHibernate provided ADO.NET connection</title>

        <para>
            Alternatively, you can have the <literal>ISessionFactory</literal>
            open connections for you. The <literal>ISessionFactory</literal>
            must be provided with ADO.NET connection properties in one of the
            following ways:
        </para>

        <orderedlist spacing="compact">
            <listitem>
                <para>
                    Pass an instance of <literal>IDictionary</literal> mapping
                    property names to property values to
                    <literal>Configuration.SetProperties()</literal>.
                </para>
            </listitem>
            <listitem>
                <para>
                    Add the properties to a configuration section in the application
                    configuration file. The section should be named <literal>nhibernate</literal>
                    and its handler set to <literal>System.Configuration.NameValueSectionHandler</literal>.
                </para>
            </listitem>
            <listitem>
                <para>
                    Include <literal>&lt;property&gt;</literal> elements in a configuration
                    section in the application configuration file. The section should be named
                    <literal>hibernate-configuration</literal> and its handler set to
                    <literal>NHibernate.Cfg.ConfigurationSectionHandler</literal>.
                    The XML namespace of the section should be set to
                    <literal>urn:nhibernate-configuration-2.2</literal>.
                </para>
            </listitem>
            <listitem>
                <para>
                    Include <literal>&lt;property&gt;</literal> elements in
                    <literal>hibernate.cfg.xml</literal> (discussed later).
                </para>
            </listitem>
        </orderedlist>

        <para>
            If you take this approach, opening an <literal>ISession</literal> is as simple as:
        </para>

        <programlisting><![CDATA[ISession session = sessions.OpenSession(); // open a new Session
// do some data access work, an ADO.NET connection will be used on demand]]></programlisting>

        <para>
            All NHibernate property names and semantics are defined on the class 
            <literal>NHibernate.Cfg.Environment</literal>. We will now describe the most
            important settings for ADO.NET connection configuration.
        </para>

        <para>
            NHibernate will obtain (and pool) connections using an ADO.NET data provider
            if you set the following properties:
        </para>

        <table frame="topbot">
            <title>NHibernate ADO.NET Properties</title>
            <tgroup cols="2">
                <colspec colname="c1" colwidth="1*"/>
                <colspec colname="c2" colwidth="1*"/>
                <thead>
                    <row>
                        <entry>Property name</entry>
                        <entry>Purpose</entry>
                    </row>
                </thead>
            <tbody>
            <row>
                <entry>
                    <literal>connection.provider_class</literal>
                </entry>
                <entry>
                    The type of a custom <literal>IConnectionProvider</literal>.
                    <para>
                        <emphasis role="strong">eg.</emphasis> 
                        <literal>full.classname.of.ConnectionProvider</literal> if the Provider 
                        is built into NHibernate, or <literal>full.classname.of.ConnectionProvider, 
                        assembly</literal> if using an implementation of <literal>IConnectionProvider</literal>
                        not included in NHibernate.
                    </para>
                </entry>
            </row>
            <row>
                <entry>
                    <literal>connection.driver_class</literal>
                </entry>
                <entry>
                    The type of a custom <literal>IDriver</literal>, if using <literal>DriverConnectionProvider</literal>.
                    <para>
                        <literal>full.classname.of.Driver</literal> if the Driver 
                        is built into NHibernate, or <literal>full.classname.of.Driver, assembly</literal> 
                        if using an implementation of IDriver not included in NHibernate.
                    </para>
                    <para>
                        This is usually not needed, most of the time the <literal>dialect</literal> will
                        take care of setting the <literal>IDriver</literal> using a sensible default.  See the API
                        documentation of the specific dialect for the defaults.
                    </para>
                </entry>
            </row>
            <row>
                <entry>
                    <literal>connection.connection_string</literal>
                </entry>
                <entry>
                    Connection string to use to obtain the connection.
                </entry>
            </row>
            <row>
                <entry>
                    <literal>connection.connection_string_name</literal>
                </entry>
                <entry>
                    The name of the connection string (defined in <literal>&lt;connectionStrings&gt;</literal>
                    configuration file element) to use to obtain the connection.
                </entry>
            </row>
            <row>
                <entry>
                    <literal>connection.isolation</literal>
                </entry>
                <entry>
                    Set the ADO.NET transaction isolation level. Check
                    <literal>System.Data.IsolationLevel</literal> for meaningful values 
                    and the database's documentation to ensure that level is supported.
                    <para>
                        <emphasis role="strong">eg.</emphasis> 
                        <literal>Chaos, ReadCommitted, ReadUncommitted, RepeatableRead, Serializable, Unspecified </literal>
                    </para>
                </entry>
            </row>
            <row>
                <entry>
                    <literal>connection.release_mode</literal>
                </entry>
                <entry>
                    Specify when NHibernate should release ADO.NET connections.
                    See <xref linkend="transactions-connection-release" />.
                    <para>
                        <emphasis role="strong">eg.</emphasis> 
                        <literal>auto</literal> (default) | <literal>on_close</literal> |
                        <literal>after_transaction</literal>
                    </para>
                    <para>
                        Note that this setting only affects <literal>ISession</literal>s returned from
                        <literal>ISessionFactory.OpenSession</literal>.  For <literal>ISession</literal>s
                        obtained through <literal>ISessionFactory.GetCurrentSession</literal>, the
                        <literal>ICurrentSessionContext</literal> implementation configured for use
                        controls the connection release mode for those <literal>ISession</literal>s.
                        See <xref linkend="architecture-current-session"/>.
                    </para>
                </entry>
            </row>
            <row>
                <entry>
                    <literal>command_timeout</literal>
                </entry>
                <entry>
                    Specify the default timeout of <literal>IDbCommands</literal>
                    generated by NHibernate.
                </entry>
            </row>
            <row>
                <entry>
                    <literal>adonet.batch_size</literal>
                </entry>
                <entry>
                    Specify the batch size to use when batching update statements. Setting this to 0
                    (the default) disables the functionality.
                    See <xref linkend="performance-batch-updates" />.
                </entry>
            </row>
            </tbody>
            </tgroup>
        </table>

        <para>
            This is an example of how to specify the database connection properties inside a 
            <literal>web.config</literal>:
        </para>

        <programlisting id="we-config-configuration" revision="1"><![CDATA[<?xml version="1.0" encoding="utf-8" ?>
<configuration>
	<configSections>
		<section name="hibernate-configuration"
				 type="NHibernate.Cfg.ConfigurationSectionHandler, NHibernate" />
	</configSections>

	<hibernate-configuration xmlns="urn:nhibernate-configuration-2.2">
		<session-factory>
			<property name="dialect">NHibernate.Dialect.MsSql2005Dialect</property>
			<property name="connection.connection_string">
				Server=(local);initial catalog=theDb;Integrated Security=SSPI
			</property>
			<property name="connection.isolation">ReadCommitted</property>

			<property name="proxyfactory.factory_class">
				NHibernate.ByteCode.LinFu.ProxyFactoryFactory, NHibernate.ByteCode.LinFu
			</property>
		</session-factory>
	</hibernate-configuration>

    <!-- other app specific config follows -->
</configuration>]]></programlisting>

        <para>
            NHibernate relies on the ADO.NET data provider implementation of connection pooling.
        </para>

        <para>
            You may define your own plugin strategy for obtaining ADO.NET connections by implementing the
            interface <literal>NHibernate.Connection.IConnectionProvider</literal>. You may select
            a custom implementation by setting <literal>connection.provider_class</literal>.
        </para>

    </sect1>

    <sect1 id="configuration-optional">
        <title>Optional configuration properties</title>
        
        <para>
            There are a number of other properties that control the behaviour of NHibernate
            at runtime. All are optional and have reasonable default values.
        </para>

        <para>
            System-level properties can only be set manually by setting static properties of
            <literal>NHibernate.Cfg.Environment</literal> class or be defined in the
            <literal>&lt;nhibernate&gt;</literal> section of the application
            configuration file. These properties cannot be set using
            <literal>Configuration.SetProperties</literal> or be defined in the
            <literal>&lt;hibernate-configuration&gt;</literal> section of the application configuration
            file.
        </para>

        <table frame="topbot" id="configuration-optional-properties" revision="3">
            <title>NHibernate Configuration Properties</title>
            <tgroup cols="2">
                <colspec colname="c1" colwidth="1*"/>
                <colspec colname="c2" colwidth="1*"/>
                <thead>
                    <row>
                        <entry>Property name</entry>
                        <entry>Purpose</entry>
                    </row>
                </thead>
                <tbody>
                    <row>
                        <entry>
                            <literal>dialect</literal>
                        </entry>
                        <entry>
                            The classname of a NHibernate <literal>Dialect</literal> - enables
                            certain platform dependent features.
                            <para>
                                <emphasis role="strong">eg.</emphasis> 
                                <literal>full.classname.of.Dialect, assembly</literal>
                            </para>
                        </entry>
                    </row>
                    <row>
                        <entry>
                            <literal>default_schema</literal>
                        </entry>
                        <entry>
                            Qualify unqualified tablenames with the given schema/tablespace
                            in generated SQL.
                            <para>
                                <emphasis role="strong">eg.</emphasis> 
                                <literal>SCHEMA_NAME</literal>
                            </para>
                        </entry>
                    </row>
                    <row>
                        <entry>
                            <literal>max_fetch_depth</literal>
                        </entry>
                        <entry>
                            Set a maximum "depth" for the outer join fetch tree
                            for single-ended associations (one-to-one, many-to-one).
                            A <literal>0</literal> disables default outer join fetching.
                            <para>
                                <emphasis role="strong">eg.</emphasis> 
                                recommended values between <literal>0</literal> and <literal>3</literal>
                            </para>
                        </entry>
                    </row>
                    <row>
                        <entry>
                            <literal>use_reflection_optimizer</literal>
                        </entry>
                        <entry>
                            Enables use of a runtime-generated class to set or get properties of an entity
                            or component instead of using runtime reflection (System-level property).
                            The use of the reflection optimizer inflicts a certain startup cost on the
                            application but should lead to better performance in the long run.
                            You can not set this property in <literal>hibernate.cfg.xml</literal>
                            or <literal>&lt;hibernate-configuration&gt;</literal> section of the application
                            configuration file.
                            <para>
                                <emphasis role="strong">eg.</emphasis> 
                                <literal>true</literal> | <literal>false</literal>
                            </para>
                        </entry>
                    </row>
                    <row>
                        <entry>
                            <literal>bytecode.provider</literal>
                        </entry>
                        <entry>
                            Specifies the bytecode provider to use to optimize the use of reflection in NHibernate.
                            Use <literal>null</literal> to disable the optimization completely, <literal>lcg</literal>
                            to use lightweight code generation. 
                            <para>
                                <emphasis role="strong">eg.</emphasis>
                                <literal>null</literal> | <literal>lcg</literal>
                            </para>
                        </entry>
                    </row>
                    <row>
                        <entry>
                            <literal>cache.provider_class</literal>
                        </entry>
                        <entry>
                            The classname of a custom <literal>ICacheProvider</literal>.
                            <para>
                                <emphasis role="strong">eg.</emphasis> 
                                <literal>classname.of.CacheProvider, assembly</literal>
                            </para>
                        </entry>
                    </row>
                    <row>
                        <entry>
                            <literal>cache.use_minimal_puts</literal>
                        </entry>
                        <entry>
                            Optimize second-level cache operation to minimize writes, at the
                            cost of more frequent reads (useful for clustered caches).
                            <para>
                                <emphasis role="strong">eg.</emphasis> 
                                <literal>true</literal> | <literal>false</literal>
                            </para>
                        </entry>
                    </row>
                    <row>
                        <entry>
                            <literal>cache.use_query_cache</literal>
                        </entry>
                        <entry>
                            Enable the query cache, individual queries still have to be set cacheable.
                            <para>
                                <emphasis role="strong">eg.</emphasis> 
                                <literal>true</literal> | <literal>false</literal>
                            </para>
                        </entry>
                    </row>
                    <row>
                        <entry>
                            <literal>cache.query_cache_factory</literal>
                        </entry>
                        <entry>
                            The classname of a custom <literal>IQueryCacheFactory</literal> interface,
                            defaults to the built-in <literal>StandardQueryCacheFactory</literal>.
                            <para>
                                <emphasis role="strong">eg.</emphasis>
                                <literal>classname.of.QueryCacheFactory, assembly</literal>
                            </para>
                        </entry>
                    </row>
                    <row>
                        <entry>
                            <literal>cache.region_prefix</literal>
                        </entry>
                        <entry>
                            A prefix to use for second-level cache region names.
                            <para>
                                <emphasis role="strong">eg.</emphasis> 
                                <literal>prefix</literal>
                            </para>
                        </entry>
                    </row>
                    <row>
                        <entry>
                            <literal>query.substitutions</literal>
                        </entry>
                        <entry>
                            Mapping from tokens in NHibernate queries to SQL tokens
                            (tokens might be function or literal names, for example).
                            <para>
                                <emphasis role="strong">eg.</emphasis> 
                                <literal>hqlLiteral=SQL_LITERAL, hqlFunction=SQLFUNC</literal>
                            </para>
                        </entry>
                    </row>
                    <row>
                        <entry>
                            <literal>show_sql</literal>
                        </entry>
                        <entry>
                            Write all SQL statements to console.
                            <para>
                                <emphasis role="strong">eg.</emphasis> 
                                <literal>true</literal> | <literal>false</literal>
                            </para>
                        </entry>
                    </row>
                    <row>
                        <entry>
                            <literal>hbm2ddl.auto</literal>
                        </entry>
                        <entry>
                            Automatically export schema DDL to the database when the
                            <literal>ISessionFactory</literal> is created. With
                            <literal>create-drop</literal>, the database schema
                            will be dropped when the <literal>ISessionFactory</literal>
                            is closed explicitly.
                            <para>
                                <emphasis role="strong">eg.</emphasis> 
                                <literal>create</literal> | <literal>create-drop</literal>
                            </para>
                        </entry>
                    </row>
                  <row>
                    <entry>
                      <literal>hbm2ddl.keywords</literal>
                    </entry>
                    <entry>
                      Automatically import <literal>reserved/keywords</literal> from the database when the
                      <literal>ISessionFactory</literal> is created.
                      <para>
                        <emphasis role="strong">none :</emphasis>
                        disable any operation regarding RDBMS KeyWords
                      </para>
                      <para>
                        <emphasis role="strong">keywords :</emphasis>
                        imports all RDBMS KeyWords where the <literal>Dialect</literal> can provide the implementation of <literal>IDataBaseSchema</literal>.
                      </para>
                      <para>
                        <emphasis role="strong">auto-quote :</emphasis>
                        imports all RDBMS KeyWords and auto-quote all table-names/column-names .
                      </para>
                      <para>
                        <emphasis role="strong">eg.</emphasis>
                        <literal>none</literal> | <literal>keywords</literal> | <literal>auto-quote</literal>
                      </para>
                    </entry>
                  </row>
                  <row>
                        <entry>
                            <literal>use_proxy_validator</literal>
                        </entry>
                        <entry>
                            Enables or disables validation of interfaces or classes specified
                            as proxies. Enabled by default.
                            <para>
                                <emphasis role="strong">eg.</emphasis> 
                                <literal>true</literal> | <literal>false</literal>
                            </para>
                        </entry>
                    </row>
                    <row>
                        <entry>
                            <literal>transaction.factory_class</literal>
                        </entry>
                        <entry>
                            The classname of a custom <literal>ITransactionFactory</literal> implementation,
                            defaults to the built-in <literal>AdoNetWithDistributedTransactionFactory</literal>.
                            <para>
                                <emphasis role="strong">eg.</emphasis> 
                                <literal>classname.of.TransactionFactory, assembly</literal>
                            </para>
                        </entry>
                    </row>
                </tbody>
            </tgroup>
        </table>

        <sect2 id="configuration-optional-dialects">
            <title>SQL Dialects</title>

            <para>
                You should always set the <literal>dialect</literal> property to the correct
                <literal>NHibernate.Dialect.Dialect</literal> subclass for your database. This is not
                strictly essential unless you wish to use <literal>native</literal> or
                <literal>sequence</literal> primary key generation or pessimistic locking (with, eg.
                <literal>ISession.Lock()</literal> or <literal>IQuery.SetLockMode()</literal>).
                However, if you specify a dialect, NHibernate will use sensible defaults for some of the
                other properties listed above, saving you the effort of specifying them manually.
            </para>

            <table frame="topbot" id="sql-dialects" revision="2">
                <title>NHibernate SQL Dialects (<literal>dialect</literal>)</title>
                <tgroup cols="2">
                    <colspec colwidth="1*"/>
                    <colspec colwidth="2.5*"/>
                    <colspec colwidth="2.5*"/>
                    <thead>
                        <row>
                            <entry>RDBMS</entry>
                            <entry>Dialect</entry>
                            <entry>Remarks</entry>
                        </row>
                    </thead>
                    <tbody>
                        <row>
                            <entry>DB2</entry> 
                            <entry><literal>NHibernate.Dialect.DB2Dialect</literal></entry>
                            <entry></entry>
                        </row>
                        <row>
                            <entry>DB2 for iSeries (OS/400)</entry> 
                            <entry><literal>NHibernate.Dialect.DB2400Dialect</literal></entry>
                            <entry></entry>
                        </row>
                        <row>
                            <entry>Ingres</entry>
                            <entry><literal>NHibernate.Dialect.IngresDialect</literal></entry>
                            <entry></entry>
                        </row>
                        <row>
                            <entry>PostgreSQL</entry> 
                            <entry><literal>NHibernate.Dialect.PostgreSQLDialect</literal></entry>
                            <entry></entry>
                        </row>
                        <row>
                            <entry>PostgreSQL 8.1</entry> 
                            <entry><literal>NHibernate.Dialect.PostgreSQL81Dialect</literal></entry>
                            <entry>
                                This dialect supports <literal>FOR UPDATE NOWAIT</literal>
                                available in PostgreSQL 8.1.
                            </entry>
                        </row>
                        <row>
                            <entry>PostgreSQL 8.2</entry> 
                            <entry><literal>NHibernate.Dialect.PostgreSQL82Dialect</literal></entry>
                            <entry>
                                This dialect supports <literal>IF EXISTS</literal> keyword in
                                <literal>DROP TABLE</literal> and <literal>DROP SEQUENCE</literal>
                                available in PostgreSQL 8.2.
                            </entry>
                        </row>
                        <row>
                            <entry>MySQL 3 or 4</entry> 
                            <entry><literal>NHibernate.Dialect.MySQLDialect</literal></entry>
                            <entry></entry>
                        </row>
                        <row>
                            <entry>MySQL 5</entry>
                            <entry><literal>NHibernate.Dialect.MySQL5Dialect</literal></entry>
                            <entry></entry>
                        </row>
                        <row>
                            <entry>Oracle</entry> 
                            <entry><literal>NHibernate.Dialect.Oracle8iDialect</literal></entry>
                            <entry></entry>
                        </row>
                        <row>
                            <entry>Oracle 9i</entry> 
                            <entry><literal>NHibernate.Dialect.Oracle9iDialect</literal></entry>
                            <entry></entry>
                        </row>
                        <row>
                            <entry>Oracle 10g, Oracle 11g</entry> 
                            <entry><literal>NHibernate.Dialect.Oracle10gDialect</literal></entry>
                            <entry></entry>
                        </row>
                        <row>
                            <entry>Oracle 12c</entry> 
                            <entry><literal>NHibernate.Dialect.Oracle12cDialect</literal></entry>
                            <entry></entry>
                        </row>
                        <row>
                            <entry>Sybase Adaptive Server Enterprise 15</entry> 
                            <entry><literal>NHibernate.Dialect.SybaseASE15Dialect</literal></entry>
                            <entry></entry>
                        </row>
                        <row>
                            <entry>Sybase Adaptive Server Anywhere 9</entry>
                            <entry><literal>NHibernate.Dialect.SybaseASA9Dialect</literal></entry>
                            <entry></entry>
                        </row>                        
                        <row>
                            <entry>Sybase SQL Anywhere 10</entry>
                            <entry><literal>NHibernate.Dialect.SybaseSQLAnywhere10Dialect</literal></entry>
                            <entry></entry>
                        </row>
                        <row>
                            <entry>Sybase SQL Anywhere 11</entry>
                            <entry><literal>NHibernate.Dialect.SybaseSQLAnywhere11Dialect</literal></entry>
                            <entry></entry>
                        </row>
                        <row>
                            <entry>Microsoft SQL Server 7</entry> 
                            <entry><literal>NHibernate.Dialect.MsSql7Dialect</literal></entry>
                            <entry></entry>
                        </row>
                        <row>
                            <entry>Microsoft SQL Server 2000</entry> 
                            <entry><literal>NHibernate.Dialect.MsSql2000Dialect</literal></entry>
                            <entry></entry>
                        </row>
                        <row>
                            <entry>Microsoft SQL Server 2005</entry> 
                            <entry><literal>NHibernate.Dialect.MsSql2005Dialect</literal></entry>
                            <entry></entry>
                        </row>
                        <row>
                            <entry>Microsoft SQL Server 2008</entry> 
                            <entry><literal>NHibernate.Dialect.MsSql2008Dialect</literal></entry>
                            <entry></entry>
                        </row>
                        <row>
                            <entry>Microsoft SQL Server Compact Edition</entry>
                            <entry><literal>NHibernate.Dialect.MsSqlCeDialect</literal></entry>
                        </row>
                        <row>
                            <entry>Firebird</entry> 
                            <entry><literal>NHibernate.Dialect.FirebirdDialect</literal></entry>
                            <entry>
                                Set <literal>driver_class</literal> to
                                <literal>NHibernate.Driver.FirebirdClientDriver</literal>
                                for Firebird ADO.NET provider 2.0.
                            </entry>
                        </row>
                        <row>
                            <entry>SQLite</entry>
                            <entry><literal>NHibernate.Dialect.SQLiteDialect</literal></entry>
                            <entry>
                                Set <literal>driver_class</literal> to
                                <literal>NHibernate.Driver.SQLite20Driver</literal>
                                for System.Data.SQLite provider for .NET 2.0.
                            </entry>
                        </row>
                    </tbody>
                </tgroup>
            </table>

            <para>
                Additional dialects may be available in the NHibernate.Dialect namespace.
            </para>

        </sect2>

        <sect2 id="configuration-optional-outerjoin">
            <title>Outer Join Fetching</title>

            <para>
                If your database supports ANSI or Oracle style outer joins, <emphasis>outer join
                fetching</emphasis> might increase performance by limiting the number of round
                trips to and from the database (at the cost of possibly more work performed by
                the database itself). Outer join fetching allows a graph of objects connected
                by many-to-one, one-to-many or one-to-one associations to be retrieved in a single
                SQL <literal>SELECT</literal>.
            </para>

            <para>
                By default, the fetched graph when loading an objects ends at leaf objects,
                collections, objects with proxies, or where circularities occur.
            </para>

            <para>
                For a <emphasis>particular  association</emphasis>, fetching may be configured
                (and the default behaviour overridden) by setting the <literal>fetch</literal>
                attribute in the XML mapping.
            </para>

            <para>
                Outer join fetching may be disabled <emphasis>globally</emphasis> by setting
                the property <literal>max_fetch_depth</literal> to <literal>0</literal>.
                A setting of <literal>1</literal> or higher enables outer join fetching for
                one-to-one and many-to-one associations which have been mapped with
                <literal>fetch="join"</literal>.
            </para>
            
            <para>
                See <xref linkend="performance-fetching"/> for more information.
            </para>

            <para>
                In NHibernate 1.0, <literal>outer-join</literal> attribute could be used to achieve
                a similar effect. This attribute is now deprecated in favor of <literal>fetch</literal>.
            </para>

        </sect2>

        <sect2 id="configuration-optional-cacheprovider">
            <title>Custom <literal>ICacheProvider</literal></title>

            <para>
                You may integrate a process-level (or clustered) second-level cache system by
                implementing the interface <literal>NHibernate.Cache.ICacheProvider</literal>.
                You may select the custom implementation by setting
                <literal>cache.provider_class</literal>. See the 
                <xref linkend="performance-cache"/> for more details.
            </para>

        </sect2>

        <sect2 id="configuration-optional-querysubstitution">
            <title>Query Language Substitution</title>

            <para>
                You may define new NHibernate query tokens using <literal>query.substitutions</literal>.
                For example:
            </para>

            <programlisting>query.substitutions true=1, false=0</programlisting>

            <para>
                would cause the tokens <literal>true</literal> and <literal>false</literal> to be translated to
                integer literals in the generated SQL.
            </para>

            <programlisting>query.substitutions toLowercase=LOWER</programlisting>

            <para>
                would allow you to rename the SQL <literal>LOWER</literal> function.
            </para>

        </sect2>

    </sect1>

    <sect1 id="configuration-logging">
        <title>Logging</title>

        <para>
            NHibernate logs various events using Apache log4net.
        </para>

        <para>
            You may download log4net from <literal>http://logging.apache.org/log4net/</literal>.
            To use log4net you will need a <literal>log4net</literal> configuration section in
            the application configuration file.  An example of the configuration section is
            distributed with NHibernate in the <literal>src/NHibernate.Test</literal> project.
        </para>

        <para>
            We strongly recommend that you familiarize yourself with NHibernate's log
            messages. A lot of work has been put into making the NHibernate log as
            detailed as possible, without making it unreadable. It is an essential
            troubleshooting device. Also don't forget to enable SQL logging as
            described above (<literal>show_sql</literal>), it is your first
            step when looking for performance problems.
        </para>
        
    </sect1>

    <sect1 id="configuration-namingstrategy">
        <title>Implementing an <literal>INamingStrategy</literal></title>

        <para>
            The interface <literal>NHibernate.Cfg.INamingStrategy</literal> allows you
            to specify a "naming standard" for database objects and schema elements.
        </para>

        <para>
            You may provide rules for automatically generating database identifiers from
            .NET identifiers or for processing "logical" column and table names given in
            the mapping file into  "physical" table and column names. This feature helps
            reduce the verbosity of the mapping document, eliminating repetitive noise
            (<literal>TBL_</literal> prefixes, for example). The default strategy used by
            NHibernate is quite minimal.
        </para>

        <para>
            You may specify a different strategy by calling
            <literal>Configuration.SetNamingStrategy()</literal> before adding mappings:
        </para>

        <programlisting><![CDATA[ISessionFactory sf = new Configuration()
    .SetNamingStrategy(ImprovedNamingStrategy.Instance)
    .AddFile("Item.hbm.xml")
    .AddFile("Bid.hbm.xml")
    .BuildSessionFactory();]]></programlisting>
    
        <para>
            <literal>NHibernate.Cfg.ImprovedNamingStrategy</literal> is a built-in
            strategy that might be a useful starting point for some applications.
        </para>

    </sect1>

    <sect1 id="configuration-xmlconfig">
        <title>XML Configuration File</title>

        <para>
            An alternative approach is to specify a full configuration in a file named
            <literal>hibernate.cfg.xml</literal>. This file can be used as a replacement
            for the <literal>&lt;nhibernate;&gt;</literal> or <literal>&lt;hibernate-configuration&gt;</literal>
            sections of the application configuration file.
        </para>

        <para>
            The XML configuration file is by default expected to be in your application directory.
            Here is an example:
        </para>

        <programlisting><![CDATA[<?xml version='1.0' encoding='utf-8'?>
<hibernate-configuration xmlns="urn:nhibernate-configuration-2.2">

    <!-- an ISessionFactory instance -->
    <session-factory>

        <!-- properties -->
        <property name="connection.provider">NHibernate.Connection.DriverConnectionProvider</property>
        <property name="connection.driver_class">NHibernate.Driver.SqlClientDriver</property>
        <property name="connection.connection_string">Server=localhost;initial catalog=nhibernate;User Id=;Password=</property>
        <property name="show_sql">false</property>
        <property name="dialect">NHibernate.Dialect.MsSql2000Dialect</property>

        <!-- mapping files -->
        <mapping resource="NHibernate.Auction.Item.hbm.xml" assembly="NHibernate.Auction" />
        <mapping resource="NHibernate.Auction.Bid.hbm.xml" assembly="NHibernate.Auction" />

    </session-factory>

</hibernate-configuration>]]></programlisting>

       <para>
           Configuring NHibernate is then as simple as
       </para>

       <programlisting><![CDATA[ISessionFactory sf = new Configuration().Configure().BuildSessionFactory();]]></programlisting>

       <para>
           You can pick a different XML configuration file using
       </para>

       <programlisting id="configuration-xmlconfig-ex3" revision="1"><![CDATA[ISessionFactory sf = new Configuration()
    .Configure("/path/to/config.cfg.xml")
    .BuildSessionFactory();]]></programlisting>

    </sect1>

</chapter>

